{% comment %}
  Wheel Section
  Essa section renderiza a roda com GSAP + ScrollTrigger
{% endcomment %}

<section id="wheelSection" class="py-5">
  <div class="wheel-container">
    <div class="row">
      <div class="col-md-6">
        <div class="wheel">
          <img src="{{ 'wheel-inactive.webp' | asset_url }}" alt="Wheel base">

          <div class="wheel-parts" id="myTab" role="tablist">
            <img class="wheel-item wheel-staffing" src="{{ 'wheel-staffing-active.webp' | asset_url }}" id="staffing-tab">
            <img class="wheel-item wheel-property" src="{{ 'wheel-property-active.webp' | asset_url }}" id="property-tab">
            <img class="wheel-item wheel-hr" src="{{ 'wheel-hr-active.webp' | asset_url }}" id="hr-tab">
            <img class="wheel-item wheel-in-home" src="{{ 'wheel-in-home-active.webp' | asset_url }}" id="inHome-tab">
            <img class="wheel-item wheel-service" src="{{ 'wheel-service-active.webp' | asset_url }}" id="service-tab">
          </div>
        </div>
      </div>

      <div class="col-md-5 offset-md-1 d-flex align-items-center justify-content-center">
        <div class="wheel-content">
          <div class="text-block wheel-staffing-content">
            <h3>{{ section.settings.staffing_title }}</h3>
            <p>{{ section.settings.staffing_text }}</p>
          </div>
          <div class="text-block wheel-property-content">
            <h3>{{ section.settings.property_title }}</h3>
            <p>{{ section.settings.property_text }}</p>
          </div>
          <div class="text-block wheel-hr-content">
            <h3>{{ section.settings.hr_title }}</h3>
            <p>{{ section.settings.hr_text }}</p>
          </div>
          <div class="text-block wheel-in-home-content">
            <h3>{{ section.settings.inhome_title }}</h3>
            <p>{{ section.settings.inhome_text }}</p>
          </div>
          <div class="text-block wheel-service-content">
            <h3>{{ section.settings.service_title }}</h3>
            <p>{{ section.settings.service_text }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


<style>
  /* Cola aqui o CSS que você já tem */
  #wheelSection img { width:100%; }
  .wheel-container { max-width:1140px; margin:auto; }
  .wheel { position:relative; margin-bottom:2rem; }
  .wheel-parts { position:absolute; inset:0; }
  .wheel-parts img { opacity:0; position:absolute; max-width:74%; top:60.25%; left:13%; z-index:1; }
  .wheel-parts .active { opacity:1; transform:scale(1.2); }
  .wheel-content .text-block { opacity:0; display:none; }
  #wheelSection { 
  scroll-behavior: auto !important;
  padding-top: 2rem;
  padding-bottom: 2rem;
  box-sizing: border-box;
  -webkit-font-smoothing: antialiased;
}

#wheelSection img { 
  width: 100%;
  height: auto;
  display: block;
  -webkit-user-drag: none; /* evita arrastar imagens */
}

/* container */
#wheelSection .wheel-container{
  margin: 0 auto;
  max-width: 1140px;
  padding: 0 15px;
  box-sizing: border-box;
}

/* grid (scoped fallback caso não exista Bootstrap no tema) */
#wheelSection .row{
  display: flex;
  flex-wrap: wrap;
  align-items: flex-start;
  margin-left: -15px;
  margin-right: -15px;
  box-sizing: border-box;
}
#wheelSection .row > [class*="col-"]{
  padding-left: 15px;
  padding-right: 15px;
  box-sizing: border-box;
}
#wheelSection .col-md-6{ flex: 0 0 50%; max-width: 50%; }
#wheelSection .col-md-5{ flex: 0 0 41.666667%; max-width: 41.666667%; }
#wheelSection .offset-md-1{ margin-left: 8.333333%; }

/* wheel base */
#wheelSection .wheel{ 
  position: relative;
  margin-bottom: 2rem;
}

/* camada das partes (imagens sobrepostas) */
#wheelSection .wheel-parts{
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}

/* itens da roda (posicionados) */
#wheelSection .wheel-parts img{
  opacity: 0;
  position: absolute;
  max-width: 74%;
  top: 60.25%;
  left: 13%;
  right: auto;
  bottom: auto;
  z-index: 1;
  transform-origin: 50% 50%;
  transition: transform .4s ease-in-out, opacity .35s ease-in-out;
  cursor: pointer;
  pointer-events: auto; /* garante que sejam clicáveis */
}

/* posições (valores base herdados do seu estilo original) */
#wheelSection .wheel-in-home{
  top: 35.5%;
  left: -21.5%;
  transform: rotate(72deg);
  max-width: 48%;
}
#wheelSection .wheel-property{
  top: 35.5%;
  left: 47.5%;
  transform: rotate(288deg);
  max-width: 48%;
}
#wheelSection .wheel-service{
  top: -4.75%;
  left: -8.25%;
  transform: rotate(144deg);
  max-width: 48%;
}
#wheelSection .wheel-staffing{
  top: -4.75%;
  left: 34.25%;
  transform: rotate(216deg);
  max-width: 48%;
}

/* classe active (fallback visual; GSAP fará a animação) */
#wheelSection .wheel-parts img.active{
  opacity: 1;
  transform: scale(1.2) !important; /* !important evita conflito com transform estático */
  z-index: 3;
}

/* conteúdo ao lado da roda (textos) */
#wheelSection .wheel-content{
  min-height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  padding: 0 10px;
}
#wheelSection .wheel-content .text-block{
  opacity: 0;
  visibility: hidden;
  display: none;
  transition: opacity .25s ease-in-out, visibility .25s;
  max-width: 520px;
  text-align: left;
}

/* quando visível (fallback) */
#wheelSection .wheel-content .text-block.is-visible,
#wheelSection .wheel-content .text-block[aria-hidden="false"]{
  display: block;
  opacity: 1;
  visibility: visible;
}

/* tipografia */
#wheelSection h3{
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  margin: 0 0 .5rem 0;
  font-size: 1.5rem;
  line-height: 1.2;
}
#wheelSection p{
  margin: 0;
  line-height: 1.6;
}

/* Footer próximo (mantive aparência simples) */
#wheelSection + .footer{
  background: #f8f9fa;
  padding: 3rem 1rem;
  text-align: center;
}

/* =========================
   Responsividade
   ========================= */
@media (max-width: 991px){
  #wheelSection .col-md-6,
  #wheelSection .col-md-5,
  #wheelSection .offset-md-1{
    flex: 0 0 100%;
    max-width: 100%;
    margin-left: 0;
  }

  /* para telas menores deixamos as partes da roda fluírem e aparecerem em linha abaixo da base,
     pois os posicionamentos absolutos costumam quebrar em widths menores */
  #wheelSection .wheel-parts img{
    position: relative;
    opacity: 1;          /* mostramos como fallback no mobile */
    max-width: 46%;
    top: auto;
    left: auto;
    transform: none;
    display: inline-block;
    margin: 6px;
    z-index: 2;
  }

  #wheelSection .wheel{
    display: flex;
    justify-content: center;
  }

  #wheelSection .wheel-content{
    padding-top: 1rem;
  }

  #wheelSection .wheel-content .text-block{
    display: block;
    opacity: 1;
    visibility: visible;
  }
}

@media (max-width: 420px){
  #wheelSection .wheel-parts img{
    max-width: 60%;
  }
  #wheelSection h3{ font-size: 1.25rem; }
}
</style>

<script>
  document.addEventListener("DOMContentLoaded", function(){
    if (typeof gsap !== "undefined" && typeof ScrollTrigger !== "undefined") {
      gsap.registerPlugin(ScrollTrigger);
      const images = gsap.utils.toArray("#wheelSection img.wheel-item");
      const paneTexts = gsap.utils.toArray("#wheelSection .wheel-content .text-block");

      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: "#wheelSection",
          start: "top top",
          end: "+=300%",
          pin: true,
          scrub: true,
        }
      });

      images.forEach((img, i) => {
        const text = paneTexts[i];
        tl.to(img, { scale: 1.2, autoAlpha: 1, ease: "none" })
          .to(text, { autoAlpha: 1, display: "block" }, "<")
          .to(img, { scale: 1, duration: 0.15, ease: "power1.in" }, "+=0.5")
          .to(text, { autoAlpha: 0, display: "none" }, "<")
          .set(img, { autoAlpha: 0 });
      });
    }
  });
</script>

{% schema %}
{
  "name": "Wheel Section",
  "settings": [
    { "type": "text", "id": "staffing_title", "label": "Staffing Title", "default": "Staffing" },
    { "type": "textarea", "id": "staffing_text", "label": "Staffing Text", "default": "Some content..." },

    { "type": "text", "id": "property_title", "label": "Property Title", "default": "Property Management" },
    { "type": "textarea", "id": "property_text", "label": "Property Text", "default": "Some content..." },

    { "type": "text", "id": "hr_title", "label": "HR Title", "default": "HR & Employee Oversight" },
    { "type": "textarea", "id": "hr_text", "label": "HR Text", "default": "Some content..." },

    { "type": "text", "id": "inhome_title", "label": "In-Home Title", "default": "In-Home Care" },
    { "type": "textarea", "id": "inhome_text", "label": "In-Home Text", "default": "Some content..." },

    { "type": "text", "id": "service_title", "label": "Service Title", "default": "Service Provider Sourcing" },
    { "type": "textarea", "id": "service_text", "label": "Service Text", "default": "Some content..." }
  ],
  "presets": [
    { "name": "Wheel Section", "category": "Custom" }
  ]
}
{% endschema %}
